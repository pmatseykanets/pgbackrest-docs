<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dedicated Repository Host | pgBackRest</title>
    <meta name="description" content="Reliable PostgreSQL Backup &amp; Restore">
    <link rel="icon" href="/pgbackrest-docs/logo.png">
    
    <link rel="preload" href="/pgbackrest-docs/assets/css/0.styles.18edf712.css" as="style"><link rel="preload" href="/pgbackrest-docs/assets/js/app.01ebea85.js" as="script"><link rel="preload" href="/pgbackrest-docs/assets/js/36.996e8c9b.js" as="script"><link rel="prefetch" href="/pgbackrest-docs/assets/js/26.e11cc072.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/2.ea010887.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/3.b7507089.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/4.cfc39c6d.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/5.6b11616c.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/6.df92328a.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/7.58324044.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/8.c87957ea.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/9.0fb232f6.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/10.972bbafb.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/11.e78eb127.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/12.5928bd53.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/13.1c12197c.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/14.d84f628c.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/15.4adcb884.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/16.ef3b7049.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/17.9d3117d9.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/18.0bcae378.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/19.295fa193.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/20.94847527.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/21.b5e7b8b5.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/22.d07ad4dd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/23.77d36072.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/24.6b6691b4.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/25.f9425e67.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/27.78d9feea.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/28.1f99e16d.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/29.28bb7045.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/30.cff46cbe.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/31.47660e90.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/32.9df22cac.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/33.37935b34.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/34.9706bcdc.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/35.5ec6e936.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/37.4718e56d.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/38.b3445822.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/39.c3ad3059.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/40.567d1aff.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/41.d0b20dd8.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/42.663bd5fd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/43.d28dcd20.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/44.2dd273bd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/45.bf622f74.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/46.0d093936.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/47.4a1a0f05.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/48.808678bd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/49.18e9d1eb.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/50.fa7ae22a.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/51.63339b12.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/52.8b737e70.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/53.974f5c76.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/54.9d3ce5c2.js">
    <link rel="stylesheet" href="/pgbackrest-docs/assets/css/0.styles.18edf712.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/pgbackrest-docs/" class="home-link router-link-active"><!----><span class="site-name">
      pgBackRest
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/pgbackrest-docs/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/pgbackrest-docs/releases/" class="nav-link">Releases</a></div><div class="nav-item"><a href="/pgbackrest-docs/config/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/pgbackrest-docs/commands/" class="nav-link">Commands</a></div><a href="https://github.com/pgbackrest/pgbackrest" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/pgbackrest-docs/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/pgbackrest-docs/releases/" class="nav-link">Releases</a></div><div class="nav-item"><a href="/pgbackrest-docs/config/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/pgbackrest-docs/commands/" class="nav-link">Commands</a></div><a href="https://github.com/pgbackrest/pgbackrest" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Guide</span><!----></p><ul class="sidebar-group-items"><li><a href="/pgbackrest-docs/guide/" class="sidebar-link">Introduction</a></li><li><a href="/pgbackrest-docs/guide/features.html" class="sidebar-link">Features</a></li><li><a href="/pgbackrest-docs/guide/concepts.html" class="sidebar-link">Concepts</a></li><li><a href="/pgbackrest-docs/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/pgbackrest-docs/guide/quick_start.html" class="sidebar-link">Quick Start</a></li><li><a href="/pgbackrest-docs/guide/backup.html" class="sidebar-link">Backup</a></li><li><a href="/pgbackrest-docs/guide/monitoring.html" class="sidebar-link">Monitoring</a></li><li><a href="/pgbackrest-docs/guide/retention.html" class="sidebar-link">Retention</a></li><li><a href="/pgbackrest-docs/guide/restore.html" class="sidebar-link">Restore</a></li><li><a href="/pgbackrest-docs/guide/point_in_time_recovery.html" class="sidebar-link">Point In Time Recovery</a></li><li><a href="/pgbackrest-docs/guide/s3_support.html" class="sidebar-link">AWS S3 Support</a></li><li><a href="/pgbackrest-docs/guide/deleting_stanza.html" class="sidebar-link">Deleting a Stanza</a></li><li><a href="/pgbackrest-docs/guide/dedicated_repository_host.html" class="active sidebar-link">Dedicated Repository Host</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pgbackrest-docs/guide/dedicated_repository_host.html#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/pgbackrest-docs/guide/dedicated_repository_host.html#setup-trusted-ssh" class="sidebar-link">Setup Trusted SSH</a></li><li class="sidebar-sub-header"><a href="/pgbackrest-docs/guide/dedicated_repository_host.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/pgbackrest-docs/guide/dedicated_repository_host.html#perform-a-backup" class="sidebar-link">Perform a Backup</a></li><li class="sidebar-sub-header"><a href="/pgbackrest-docs/guide/dedicated_repository_host.html#restore-a-backup" class="sidebar-link">Restore a Backup</a></li></ul></li><li><a href="/pgbackrest-docs/guide/parallel_backup_restore.html" class="sidebar-link">Parallel Backup / Restore</a></li><li><a href="/pgbackrest-docs/guide/starting_and_stopping.html" class="sidebar-link">Starting And Stopping</a></li><li><a href="/pgbackrest-docs/guide/replication.html" class="sidebar-link">Replication</a></li><li><a href="/pgbackrest-docs/guide/asynchronous_archiving.html" class="sidebar-link">Asynchronous Archiving</a></li><li><a href="/pgbackrest-docs/guide/backup_from_standby.html" class="sidebar-link">Backup From a Standby</a></li><li><a href="/pgbackrest-docs/guide/upgrading_postgresql.html" class="sidebar-link">Upgrading PostgreSQL</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="dedicated-repository-host"><a href="#dedicated-repository-host" aria-hidden="true" class="header-anchor">#</a> Dedicated Repository Host</h1><p>The configuration described in Quickstart is suitable for simple installations but for enterprise configurations it is more typical to have a dedicated repository host where the backups and WAL archive files are stored. This separates the backups and WAL archive from the database server so database host failures have less impact. It is still a good idea to employ traditional backup software to backup the repository host.</p><h2 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h2><p>A new host named repository is created to store the cluster backups.
The pgbackrest user is created to own the pgBackRest repository. Any user can own the repository but it is best not to use postgres (if it exists) to avoid confusion.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Create pgbackrest</span>
<span class="token function">sudo</span> adduser --disabled-password --gecos <span class="token string">&quot;&quot;</span> pgbackrest
</code></pre></div><p>pgBackRest is written in Perl which is included with Debian/Ubuntu by default. Some additional modules must also be installed but they are available as standard packages.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Install required Perl packages</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libdbd-pg-perl libio-socket-ssl-perl libxml-libxml-perl
</code></pre></div><p>Debian/Ubuntu packages for pgBackRest are available at <a href="https://www.postgresql.org/download/linux/ubuntu/" target="_blank" rel="noopener noreferrer">apt.postgresql.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. If they are not provided for your distribution/version it is easy to download the source and install manually.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Download version 2.02 of pgBackRest</span>
<span class="token function">sudo</span> <span class="token function">wget</span> -q -O - \
       https://github.com/pgbackrest/pgbackrest/archive/release/2.02.tar.gz <span class="token operator">|</span> \
       <span class="token function">sudo</span> <span class="token function">tar</span> zx -C /root
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Install pgBackRest</span>
<span class="token function">sudo</span> <span class="token function">cp</span> -r /root/pgbackrest-release-2.02/lib/pgBackRest \
       /usr/share/perl5
<span class="token function">sudo</span> <span class="token function">find</span> /usr/share/perl5/pgBackRest -type f -exec <span class="token function">chmod</span> 644 <span class="token punctuation">{</span><span class="token punctuation">}</span> +
<span class="token function">sudo</span> <span class="token function">find</span> /usr/share/perl5/pgBackRest -type d -exec <span class="token function">chmod</span> 755 <span class="token punctuation">{</span><span class="token punctuation">}</span> +
<span class="token function">sudo</span> <span class="token function">mkdir</span> -m 770 /var/log/pgbackrest
<span class="token function">sudo</span> <span class="token function">chown</span> pgbackrest:pgbackrest /var/log/pgbackrest
<span class="token function">sudo</span> <span class="token function">mkdir</span> /etc/pgbackrest
<span class="token function">sudo</span> <span class="token function">mkdir</span> /etc/pgbackrest/conf.d
<span class="token function">sudo</span> <span class="token function">touch</span> /etc/pgbackrest/pgbackrest.conf
<span class="token function">sudo</span> <span class="token function">chmod</span> 640 /etc/pgbackrest/pgbackrest.conf
<span class="token function">sudo</span> <span class="token function">chown</span> pgbackrest:pgbackrest /etc/pgbackrest/pgbackrest.conf
</code></pre></div><p>pgBackRest requires a companion C library that enhances performance and enables the <code>checksum-page</code> option and encryption. Pre-built packages are generally a better option than building the C library manually but the steps required are given below for completeness. Depending on the distribution a number of packages may be required which will not be enumerated here.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Build and Install C Library</span>
<span class="token function">sudo</span> sh -c <span class="token string">'cd /root/pgbackrest-release-2.02/libc &amp;&amp; \
       perl Makefile.PL INSTALLMAN1DIR=none INSTALLMAN3DIR=none'</span>
<span class="token function">sudo</span> <span class="token function">make</span> -C /root/pgbackrest-release-2.02/libc <span class="token function">test</span>
<span class="token function">sudo</span> <span class="token function">make</span> -C /root/pgbackrest-release-2.02/libc <span class="token function">install</span>
</code></pre></div><p>Although most of pgBackRest is written in Perl, the main executable is written in C. This allows certain time-critical commands (like async archive-push) to run more quickly.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Build and Install Binary</span>
<span class="token function">sudo</span> <span class="token function">make</span> -C /root/pgbackrest-release-2.02/src
<span class="token function">sudo</span> <span class="token function">make</span> -C /root/pgbackrest-release-2.02/src <span class="token function">install</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Create the pgBackRest repository</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> -p /var/lib/pgbackrest
<span class="token function">sudo</span> <span class="token function">chmod</span> 750 /var/lib/pgbackrest
<span class="token function">sudo</span> <span class="token function">chown</span> pgbackrest:pgbackrest /var/lib/pgbackrest
</code></pre></div><h2 id="setup-trusted-ssh"><a href="#setup-trusted-ssh" aria-hidden="true" class="header-anchor">#</a> Setup Trusted SSH</h2><p>pgBackRest requires trusted (no password) SSH to enable communication between the hosts.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Create repository host key pair</span>
<span class="token function">sudo</span> -u pgbackrest <span class="token function">mkdir</span> -m 750 /home/pgbackrest/.ssh
<span class="token function">sudo</span> -u pgbackrest ssh-keygen -f /home/pgbackrest/.ssh/id_rsa \
       -t rsa -b 4096 -N <span class="token string">&quot;&quot;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Create pg-primary host key pair</span>
<span class="token function">sudo</span> -u postgres <span class="token function">mkdir</span> -m 750 -p /home/postgres/.ssh
<span class="token function">sudo</span> -u postgres ssh-keygen -f /home/postgres/.ssh/id_rsa \
       -t rsa -b 4096 -N <span class="token string">&quot;&quot;</span>
</code></pre></div><p>Exchange keys between repository and pg-primary.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Copy pg-primary public key to repository</span>
<span class="token function">sudo</span> <span class="token function">ssh</span> root@pg-primary <span class="token function">cat</span> /home/postgres/.ssh/id_rsa.pub <span class="token operator">|</span> \
       <span class="token function">sudo</span> -u pgbackrest <span class="token function">tee</span> -a /home/pgbackrest/.ssh/authorized_keys
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Copy repository public key to pg-primary</span>
<span class="token function">sudo</span> <span class="token function">ssh</span> root@repository <span class="token function">cat</span> /home/pgbackrest/.ssh/id_rsa.pub <span class="token operator">|</span> \
       <span class="token function">sudo</span> -u postgres <span class="token function">tee</span> -a /home/postgres/.ssh/authorized_keys
</code></pre></div><p>Test that connections can be made from repository to pg-primary and vice versa.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Test connection from repository to pg-primary</span>
<span class="token function">sudo</span> -u pgbackrest <span class="token function">ssh</span> postgres@pg-primary
pg-primary ⇒ Test connection from pg-primary to repository
<span class="token function">sudo</span> -u postgres <span class="token function">ssh</span> pgbackrest@repository
</code></pre></div><h2 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h2><p>The repository host must be configured with the pg-primary host/user and database path. The primary will be configured as db1 to allow a standby to be added later.</p><div class="language-ini extra-class"><pre class="language-ini"><code># repository:/etc/pgbackrest/pgbackrest.conf ⇒ Configure pg1-host/pg1-host-user and pg1-path
<span class="token selector">[demo]</span>
<span class="token constant">pg1-host</span><span class="token attr-value"><span class="token punctuation">=</span>pg-primary</span>
<span class="token constant">pg1-host-user</span><span class="token attr-value"><span class="token punctuation">=</span>postgres</span>
<span class="token constant">pg1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.4/demo</span>

<span class="token selector">[global]</span>
<span class="token constant">repo1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/pgbackrest</span>
<span class="token constant">repo1-retention-full</span><span class="token attr-value"><span class="token punctuation">=</span>2</span>
<span class="token constant">start-fast</span><span class="token attr-value"><span class="token punctuation">=</span>y</span>
</code></pre></div><p>The database host must be configured with the repository host/user. The default for the repo1-host-user option is pgbackrest. If the postgres user does restores on the repository host it is best not to also allow the postgres user to perform backups. However, the postgres user can read the repository directly if it is in the same group as the pgbackrest user.</p><div class="language-ini extra-class"><pre class="language-ini"><code># pg-primary:/etc/pgbackrest/pgbackrest.conf ⇒ Configure repo1-host/repo1-host-user
<span class="token selector">[demo]</span>
<span class="token constant">pg1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.4/demo</span>

<span class="token selector">[global]</span>
<span class="token constant">log-level-file</span><span class="token attr-value"><span class="token punctuation">=</span>detail</span>
<span class="token constant">repo1-host</span><span class="token attr-value"><span class="token punctuation">=</span>repository</span>
</code></pre></div><p>Commands are run the same as on a single host configuration except that some commands such as backup and expire are run from the repository host instead of the database host.</p><p>Create the stanza in the new repository.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Create the stanza</span>
<span class="token function">sudo</span> -u pgbackrest pgbackrest --stanza<span class="token operator">=</span>demo stanza-create
</code></pre></div><p>Check that the configuration is correct on both the database and repository hosts. More information about the check command can be found in Check the Configuration.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Check the configuration</span>
<span class="token function">sudo</span> -u postgres pgbackrest --stanza<span class="token operator">=</span>demo check
repository ⇒ Check the configuration
<span class="token function">sudo</span> -u pgbackrest pgbackrest --stanza<span class="token operator">=</span>demo check
</code></pre></div><h2 id="perform-a-backup"><a href="#perform-a-backup" aria-hidden="true" class="header-anchor">#</a> Perform a Backup</h2><p>To perform a backup of the PostgreSQL cluster run pgBackRest with the backup command on the repository host.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Backup the demo cluster</span>
<span class="token function">sudo</span> -u pgbackrest pgbackrest --stanza<span class="token operator">=</span>demo backup
P00   WARN: no prior backup exists, incr backup has been changed to full
</code></pre></div><p>Since a new repository was created on the repository host the warning about the incremental backup changing to a full backup was emitted.</p><h2 id="restore-a-backup"><a href="#restore-a-backup" aria-hidden="true" class="header-anchor">#</a> Restore a Backup</h2><p>To perform a restore of the PostgreSQL cluster run pgBackRest with the restore command on the database host.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Stop the demo cluster, restore, and restart PostgreSQL</span>
<span class="token function">sudo</span> pg_ctlcluster 9.4 demo stop
<span class="token function">sudo</span> -u postgres pgbackrest --stanza<span class="token operator">=</span>demo --delta restore
<span class="token function">sudo</span> pg_ctlcluster 9.4 demo start
</code></pre></div><p>A new backup must be performed due to the timeline switch.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Backup the demo cluster</span>
<span class="token function">sudo</span> -u pgbackrest pgbackrest --stanza<span class="token operator">=</span>demo backup
</code></pre></div></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/pgbackrest/pgbackrest/edit/master/guide/dedicated_repository_host.md" target="_blank" rel="noopener noreferrer">Edit this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/pgbackrest-docs/guide/deleting_stanza.html" class="prev">
          Deleting a Stanza
        </a></span><span class="next"><a href="/pgbackrest-docs/guide/parallel_backup_restore.html">
          Parallel Backup / Restore
        </a> →
      </span></p></div></div></div></div>
    <script src="/pgbackrest-docs/assets/js/36.996e8c9b.js" defer></script><script src="/pgbackrest-docs/assets/js/app.01ebea85.js" defer></script>
  </body>
</html>
