<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Upgrading PostgreSQL | pgBackRest</title>
    <meta name="description" content="Reliable PostgreSQL Backup &amp; Restore">
    <link rel="icon" href="/pgbackrest-docs/logo.png">
    
    <link rel="preload" href="/pgbackrest-docs/assets/css/0.styles.18edf712.css" as="style"><link rel="preload" href="/pgbackrest-docs/assets/js/app.01ebea85.js" as="script"><link rel="preload" href="/pgbackrest-docs/assets/js/50.fa7ae22a.js" as="script"><link rel="prefetch" href="/pgbackrest-docs/assets/js/26.e11cc072.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/2.ea010887.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/3.b7507089.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/4.cfc39c6d.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/5.6b11616c.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/6.df92328a.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/7.58324044.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/8.c87957ea.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/9.0fb232f6.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/10.972bbafb.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/11.e78eb127.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/12.5928bd53.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/13.1c12197c.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/14.d84f628c.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/15.4adcb884.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/16.ef3b7049.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/17.9d3117d9.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/18.0bcae378.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/19.295fa193.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/20.94847527.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/21.b5e7b8b5.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/22.d07ad4dd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/23.77d36072.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/24.6b6691b4.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/25.f9425e67.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/27.78d9feea.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/28.1f99e16d.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/29.28bb7045.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/30.cff46cbe.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/31.47660e90.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/32.9df22cac.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/33.37935b34.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/34.9706bcdc.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/35.5ec6e936.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/36.996e8c9b.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/37.4718e56d.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/38.b3445822.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/39.c3ad3059.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/40.567d1aff.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/41.d0b20dd8.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/42.663bd5fd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/43.d28dcd20.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/44.2dd273bd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/45.bf622f74.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/46.0d093936.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/47.4a1a0f05.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/48.808678bd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/49.18e9d1eb.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/51.63339b12.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/52.8b737e70.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/53.974f5c76.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/54.9d3ce5c2.js">
    <link rel="stylesheet" href="/pgbackrest-docs/assets/css/0.styles.18edf712.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/pgbackrest-docs/" class="home-link router-link-active"><!----><span class="site-name">
      pgBackRest
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/pgbackrest-docs/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/pgbackrest-docs/releases/" class="nav-link">Releases</a></div><div class="nav-item"><a href="/pgbackrest-docs/config/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/pgbackrest-docs/commands/" class="nav-link">Commands</a></div><a href="https://github.com/pgbackrest/pgbackrest" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/pgbackrest-docs/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/pgbackrest-docs/releases/" class="nav-link">Releases</a></div><div class="nav-item"><a href="/pgbackrest-docs/config/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/pgbackrest-docs/commands/" class="nav-link">Commands</a></div><a href="https://github.com/pgbackrest/pgbackrest" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Guide</span><!----></p><ul class="sidebar-group-items"><li><a href="/pgbackrest-docs/guide/" class="sidebar-link">Introduction</a></li><li><a href="/pgbackrest-docs/guide/features.html" class="sidebar-link">Features</a></li><li><a href="/pgbackrest-docs/guide/concepts.html" class="sidebar-link">Concepts</a></li><li><a href="/pgbackrest-docs/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/pgbackrest-docs/guide/quick_start.html" class="sidebar-link">Quick Start</a></li><li><a href="/pgbackrest-docs/guide/backup.html" class="sidebar-link">Backup</a></li><li><a href="/pgbackrest-docs/guide/monitoring.html" class="sidebar-link">Monitoring</a></li><li><a href="/pgbackrest-docs/guide/retention.html" class="sidebar-link">Retention</a></li><li><a href="/pgbackrest-docs/guide/restore.html" class="sidebar-link">Restore</a></li><li><a href="/pgbackrest-docs/guide/point_in_time_recovery.html" class="sidebar-link">Point In Time Recovery</a></li><li><a href="/pgbackrest-docs/guide/s3_support.html" class="sidebar-link">AWS S3 Support</a></li><li><a href="/pgbackrest-docs/guide/deleting_stanza.html" class="sidebar-link">Deleting a Stanza</a></li><li><a href="/pgbackrest-docs/guide/dedicated_repository_host.html" class="sidebar-link">Dedicated Repository Host</a></li><li><a href="/pgbackrest-docs/guide/parallel_backup_restore.html" class="sidebar-link">Parallel Backup / Restore</a></li><li><a href="/pgbackrest-docs/guide/starting_and_stopping.html" class="sidebar-link">Starting And Stopping</a></li><li><a href="/pgbackrest-docs/guide/replication.html" class="sidebar-link">Replication</a></li><li><a href="/pgbackrest-docs/guide/asynchronous_archiving.html" class="sidebar-link">Asynchronous Archiving</a></li><li><a href="/pgbackrest-docs/guide/backup_from_standby.html" class="sidebar-link">Backup From a Standby</a></li><li><a href="/pgbackrest-docs/guide/upgrading_postgresql.html" class="active sidebar-link">Upgrading PostgreSQL</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="upgrading-postgresql"><a href="#upgrading-postgresql" aria-hidden="true" class="header-anchor">#</a> Upgrading PostgreSQL</h1><p>Immediately after upgrading PostgreSQL to a newer major version, the <code>pg-path</code> for all pgBackRest configurations must be set to the new database location and the <code>stanza-upgrade</code> run on the repository host. If the database is offline use the <code>--no-online</code> option.</p><div class="warning custom-block"><p class="custom-block-title">NOTE:</p><p>The following instructions are not meant to be a comprehensive guide for upgrading PostgreSQL, rather they outline the general process for upgrading a primary and standby with the intent of demonstrating the steps required to reconfigure pgBackRest. It is recommended that a backup be taken prior to upgrading.</p></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Stop old cluster and install new PostgreSQL version</span>
<span class="token function">sudo</span> pg_ctlcluster 9.4 demo stop
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> postgresql-9.5
</code></pre></div><p>Stop the old cluster on the standby since it will be restored from the newly upgraded cluster.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-standby ⇒ Stop old cluster and install new PostgreSQL version</span>
<span class="token function">sudo</span> pg_ctlcluster 9.4 demo stop
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> postgresql-9.5
</code></pre></div><p>Create the new cluster and perform upgrade.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Create new cluster and perform the upgrade</span>
<span class="token function">sudo</span> -u postgres /usr/lib/postgresql/9.5/bin/initdb \
       -D /var/lib/postgresql/9.5/demo -k -A peer
<span class="token function">sudo</span> pg_createcluster 9.5 demo
<span class="token function">sudo</span> -u postgres sh -c <span class="token string">'cd /var/lib/postgresql &amp;&amp; \
       /usr/lib/postgresql/9.5/bin/pg_upgrade \
       --old-bindir=/usr/lib/postgresql/9.4/bin \
       --new-bindir=/usr/lib/postgresql/9.5/bin \
       --old-datadir=/var/lib/postgresql/9.4/demo \
       --new-datadir=/var/lib/postgresql/9.5/demo \
       --old-options=&quot; -c config_file=/etc/postgresql/9.4/demo/postgresql.conf&quot; \
       --new-options=&quot; -c config_file=/etc/postgresql/9.5/demo/postgresql.conf&quot;'</span>
       <span class="token punctuation">[</span>filtered 68 lines of output<span class="token punctuation">]</span>
Creating script to delete old cluster                       ok
Upgrade Complete
----------------
Optimizer statistics are not transferred by pg_upgrade so,
       <span class="token punctuation">[</span>filtered 4 lines of output<span class="token punctuation">]</span>
</code></pre></div><p>Configure the new cluster settings and port.</p><div class="language-ini extra-class"><pre class="language-ini"><code># pg-primary:/etc/postgresql/9.5/demo/postgresql.conf ⇒ Configure PostgreSQL
<span class="token constant">archive_command</span> <span class="token attr-value"><span class="token punctuation">=</span> 'pgbackrest --stanza=demo archive-push %p'</span>
<span class="token constant">archive_mode</span> <span class="token attr-value"><span class="token punctuation">=</span> on</span>
<span class="token constant">listen_addresses</span> <span class="token attr-value"><span class="token punctuation">=</span> '*'</span>
<span class="token constant">log_line_prefix</span> <span class="token attr-value"><span class="token punctuation">=</span> ''</span>
<span class="token constant">max_wal_senders</span> <span class="token attr-value"><span class="token punctuation">=</span> 3</span>
<span class="token constant">port</span> <span class="token attr-value"><span class="token punctuation">=</span> 5432</span>
<span class="token constant">wal_level</span> <span class="token attr-value"><span class="token punctuation">=</span> hot_standby</span>
</code></pre></div><p>Update the pgBackRest configuration on all systems to point to the new cluster.</p><div class="language-ini extra-class"><pre class="language-ini"><code># pg-primary:/etc/pgbackrest/pgbackrest.conf ⇒ Upgrade the pg1-path
<span class="token selector">[demo]</span>
<span class="token constant">pg1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.5/demo</span>

<span class="token selector">[global]</span>
<span class="token constant">archive-async</span><span class="token attr-value"><span class="token punctuation">=</span>y</span>
<span class="token constant">log-level-file</span><span class="token attr-value"><span class="token punctuation">=</span>detail</span>
<span class="token constant">repo1-host</span><span class="token attr-value"><span class="token punctuation">=</span>repository</span>
<span class="token constant">spool-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/spool/pgbackrest</span>

<span class="token selector">[global:archive-get]</span>
<span class="token constant">process-max</span><span class="token attr-value"><span class="token punctuation">=</span>2</span>

<span class="token selector">[global:archive-push]</span>
<span class="token constant">process-max</span><span class="token attr-value"><span class="token punctuation">=</span>2</span>
</code></pre></div><div class="language-ini extra-class"><pre class="language-ini"><code># pg-standby:/etc/pgbackrest/pgbackrest.conf ⇒ Upgrade the pg-path
<span class="token selector">[demo]</span>
<span class="token constant">pg1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.5/demo</span>
<span class="token constant">recovery-option</span><span class="token attr-value"><span class="token punctuation">=</span>standby_mode=on</span>
<span class="token constant">recovery-option</span><span class="token attr-value"><span class="token punctuation">=</span>primary_conninfo=host=172.17.0.3 port=5432 user=replicator</span>

<span class="token selector">[global]</span>
<span class="token constant">archive-async</span><span class="token attr-value"><span class="token punctuation">=</span>y</span>
<span class="token constant">log-level-file</span><span class="token attr-value"><span class="token punctuation">=</span>detail</span>
<span class="token constant">repo1-host</span><span class="token attr-value"><span class="token punctuation">=</span>repository</span>
<span class="token constant">spool-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/spool/pgbackrest</span>

<span class="token selector">[global:archive-get]</span>
<span class="token constant">process-max</span><span class="token attr-value"><span class="token punctuation">=</span>2</span>

<span class="token selector">[global:archive-push]</span>
<span class="token constant">process-max</span><span class="token attr-value"><span class="token punctuation">=</span>2</span>
</code></pre></div><div class="language-ini extra-class"><pre class="language-ini"><code># repository:/etc/pgbackrest/pgbackrest.conf ⇒ Upgrade pg1-path and pg2-path, disable backup from standby
<span class="token selector">[demo]</span>
<span class="token constant">pg1-host</span><span class="token attr-value"><span class="token punctuation">=</span>pg-primary</span>
<span class="token constant">pg1-host-user</span><span class="token attr-value"><span class="token punctuation">=</span>postgres</span>
<span class="token constant">pg1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.5/demo</span>
<span class="token constant">pg2-host</span><span class="token attr-value"><span class="token punctuation">=</span>pg-standby</span>
<span class="token constant">pg2-host-user</span><span class="token attr-value"><span class="token punctuation">=</span>postgres</span>
<span class="token constant">pg2-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.5/demo</span>

<span class="token selector">[global]</span>
<span class="token constant">backup-standby</span><span class="token attr-value"><span class="token punctuation">=</span>n</span>
<span class="token constant">process-max</span><span class="token attr-value"><span class="token punctuation">=</span>3</span>
<span class="token constant">repo1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/pgbackrest</span>
<span class="token constant">repo1-retention-full</span><span class="token attr-value"><span class="token punctuation">=</span>2</span>
<span class="token constant">start-fast</span><span class="token attr-value"><span class="token punctuation">=</span>y</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Copy hba configuration</span>
<span class="token function">sudo</span> <span class="token function">cp</span> /etc/postgresql/9.4/demo/pg_hba.conf \
       /etc/postgresql/9.5/demo/pg_hba.conf
</code></pre></div><p>Before starting the new cluster, the stanza-upgrade command must be run on the server where the pgBackRest repository is located.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Upgrade the stanza</span>
<span class="token function">sudo</span> -u pgbackrest pgbackrest --stanza<span class="token operator">=</span>demo --no-online \
       --log-level-console<span class="token operator">=</span>info stanza-upgrade
P00   INFO: stanza-upgrade <span class="token function">command</span> begin 2.02: --no-backup-standby --log-level-console<span class="token operator">=</span>info --log-level-stderr<span class="token operator">=</span>off --no-log-timestamp --no-online --pg1-host<span class="token operator">=</span>pg-primary --pg2-host<span class="token operator">=</span>pg-standby --pg1-host-user<span class="token operator">=</span>postgres --pg2-host-user<span class="token operator">=</span>postgres --pg1-path<span class="token operator">=</span>/var/lib/postgresql/9.5/demo --pg2-path<span class="token operator">=</span>/var/lib/postgresql/9.5/demo --repo1-path<span class="token operator">=</span>/var/lib/pgbackrest --stanza<span class="token operator">=</span>demo
P00   INFO: stanza-upgrade <span class="token function">command</span> end: completed successfully
</code></pre></div><p>Start the new cluster and confirm it is successfully installed.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Start new cluster</span>
<span class="token function">sudo</span> pg_ctlcluster 9.5 demo start
</code></pre></div><p>Test configuration using the check command.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Check configuration</span>
<span class="token function">sudo</span> -u postgres pg_lsclusters
Ver Cluster Port Status Owner    Data directory               Log <span class="token function">file</span>
9.4 demo    5432 down   postgres /var/lib/postgresql/9.4/demo /var/log/postgresql/postgresql-9.4-demo.log
9.5 demo    5432 online postgres /var/lib/postgresql/9.5/demo /var/log/postgresql/postgresql-9.5-demo.log
<span class="token function">sudo</span> -u postgres pgbackrest --stanza<span class="token operator">=</span>demo check
</code></pre></div><p>Remove the old cluster.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-primary ⇒ Remove old cluster</span>
<span class="token function">sudo</span> pg_dropcluster 9.4 demo
</code></pre></div><p>Install the new PostgreSQL binaries on the standby and create the cluster.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-standby ⇒ Remove old cluster and create the new cluster</span>
<span class="token function">sudo</span> pg_dropcluster 9.4 demo
<span class="token function">sudo</span> pg_createcluster 9.5 demo
</code></pre></div><p>Run the check on the repository host. The warning regarding the standby being down is expected since the standby cluster is down. Running this command demonstrates that the repository server is aware of the standby and is configured properly for the primary server.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Check configuration</span>
<span class="token function">sudo</span> -u pgbackrest pgbackrest --stanza<span class="token operator">=</span>demo check
P00   WARN: <span class="token punctuation">[</span>056<span class="token punctuation">]</span>: raised from remote process on <span class="token string">'pg-standby'</span><span class="token keyword">:</span> could not connect to server: No such <span class="token function">file</span> or directory
            	Is the server running locally and accepting
            	connections on Unix domain socket <span class="token string">&quot;/var/run/postgresql/.s.PGSQL.5432&quot;</span>?
</code></pre></div><p>Run a full backup on the new cluster and then restore the standby from the backup. The backup type will automatically be changed to full if incr or diff is requested.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Run a full backup</span>
<span class="token function">sudo</span> -u pgbackrest pgbackrest --stanza<span class="token operator">=</span>demo --type<span class="token operator">=</span>full backup
pg-standby ⇒ Restore the demo standby cluster
<span class="token function">sudo</span> -u postgres pgbackrest --stanza<span class="token operator">=</span>demo --delta restore
</code></pre></div><div class="language-ini extra-class"><pre class="language-ini"><code># pg-standby:/etc/postgresql/9.5/demo/postgresql.conf ⇒ Configure PostgreSQL
<span class="token constant">hot_standby</span> <span class="token attr-value"><span class="token punctuation">=</span> on</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># pg-standby ⇒ Start PostgreSQL and check the pgBackRest configuration</span>
<span class="token function">sudo</span> pg_ctlcluster 9.5 demo start
<span class="token function">sudo</span> -u postgres pgbackrest --stanza<span class="token operator">=</span>demo check
</code></pre></div><p>Backup from standby can be enabled now that the standby is restored.</p><div class="language-ini extra-class"><pre class="language-ini"><code># repository:/etc/pgbackrest/pgbackrest.conf ⇒ Reenable backup from standby
<span class="token selector">[demo]</span>
<span class="token constant">pg1-host</span><span class="token attr-value"><span class="token punctuation">=</span>pg-primary</span>
<span class="token constant">pg1-host-user</span><span class="token attr-value"><span class="token punctuation">=</span>postgres</span>
<span class="token constant">pg1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.5/demo</span>
<span class="token constant">pg2-host</span><span class="token attr-value"><span class="token punctuation">=</span>pg-standby</span>
<span class="token constant">pg2-host-user</span><span class="token attr-value"><span class="token punctuation">=</span>postgres</span>
<span class="token constant">pg2-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.5/demo</span>

<span class="token selector">[global]</span>
<span class="token constant">backup-standby</span><span class="token attr-value"><span class="token punctuation">=</span>y</span>
<span class="token constant">process-max</span><span class="token attr-value"><span class="token punctuation">=</span>3</span>
<span class="token constant">repo1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/pgbackrest</span>
<span class="token constant">repo1-retention-full</span><span class="token attr-value"><span class="token punctuation">=</span>2</span>
<span class="token constant">start-fast</span><span class="token attr-value"><span class="token punctuation">=</span>y</span>
</code></pre></div></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/pgbackrest/pgbackrest/edit/master/guide/upgrading_postgresql.md" target="_blank" rel="noopener noreferrer">Edit this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/pgbackrest-docs/guide/backup_from_standby.html" class="prev">
          Backup From a Standby
        </a></span><!----></p></div></div></div></div>
    <script src="/pgbackrest-docs/assets/js/50.fa7ae22a.js" defer></script><script src="/pgbackrest-docs/assets/js/app.01ebea85.js" defer></script>
  </body>
</html>
