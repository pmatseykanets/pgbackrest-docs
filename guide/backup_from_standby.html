<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Backup From a Standby | pgBackRest</title>
    <meta name="description" content="Reliable PostgreSQL Backup &amp; Restore">
    <link rel="icon" href="/pgbackrest-docs/logo.png">
    
    <link rel="preload" href="/pgbackrest-docs/assets/css/0.styles.18edf712.css" as="style"><link rel="preload" href="/pgbackrest-docs/assets/js/app.01ebea85.js" as="script"><link rel="preload" href="/pgbackrest-docs/assets/js/34.9706bcdc.js" as="script"><link rel="prefetch" href="/pgbackrest-docs/assets/js/26.e11cc072.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/2.ea010887.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/3.b7507089.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/4.cfc39c6d.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/5.6b11616c.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/6.df92328a.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/7.58324044.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/8.c87957ea.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/9.0fb232f6.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/10.972bbafb.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/11.e78eb127.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/12.5928bd53.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/13.1c12197c.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/14.d84f628c.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/15.4adcb884.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/16.ef3b7049.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/17.9d3117d9.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/18.0bcae378.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/19.295fa193.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/20.94847527.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/21.b5e7b8b5.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/22.d07ad4dd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/23.77d36072.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/24.6b6691b4.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/25.f9425e67.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/27.78d9feea.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/28.1f99e16d.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/29.28bb7045.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/30.cff46cbe.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/31.47660e90.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/32.9df22cac.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/33.37935b34.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/35.5ec6e936.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/36.996e8c9b.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/37.4718e56d.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/38.b3445822.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/39.c3ad3059.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/40.567d1aff.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/41.d0b20dd8.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/42.663bd5fd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/43.d28dcd20.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/44.2dd273bd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/45.bf622f74.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/46.0d093936.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/47.4a1a0f05.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/48.808678bd.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/49.18e9d1eb.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/50.fa7ae22a.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/51.63339b12.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/52.8b737e70.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/53.974f5c76.js"><link rel="prefetch" href="/pgbackrest-docs/assets/js/54.9d3ce5c2.js">
    <link rel="stylesheet" href="/pgbackrest-docs/assets/css/0.styles.18edf712.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/pgbackrest-docs/" class="home-link router-link-active"><!----><span class="site-name">
      pgBackRest
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/pgbackrest-docs/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/pgbackrest-docs/releases/" class="nav-link">Releases</a></div><div class="nav-item"><a href="/pgbackrest-docs/config/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/pgbackrest-docs/commands/" class="nav-link">Commands</a></div><a href="https://github.com/pgbackrest/pgbackrest" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/pgbackrest-docs/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/pgbackrest-docs/releases/" class="nav-link">Releases</a></div><div class="nav-item"><a href="/pgbackrest-docs/config/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/pgbackrest-docs/commands/" class="nav-link">Commands</a></div><a href="https://github.com/pgbackrest/pgbackrest" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Guide</span><!----></p><ul class="sidebar-group-items"><li><a href="/pgbackrest-docs/guide/" class="sidebar-link">Introduction</a></li><li><a href="/pgbackrest-docs/guide/features.html" class="sidebar-link">Features</a></li><li><a href="/pgbackrest-docs/guide/concepts.html" class="sidebar-link">Concepts</a></li><li><a href="/pgbackrest-docs/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/pgbackrest-docs/guide/quick_start.html" class="sidebar-link">Quick Start</a></li><li><a href="/pgbackrest-docs/guide/backup.html" class="sidebar-link">Backup</a></li><li><a href="/pgbackrest-docs/guide/monitoring.html" class="sidebar-link">Monitoring</a></li><li><a href="/pgbackrest-docs/guide/retention.html" class="sidebar-link">Retention</a></li><li><a href="/pgbackrest-docs/guide/restore.html" class="sidebar-link">Restore</a></li><li><a href="/pgbackrest-docs/guide/point_in_time_recovery.html" class="sidebar-link">Point In Time Recovery</a></li><li><a href="/pgbackrest-docs/guide/s3_support.html" class="sidebar-link">AWS S3 Support</a></li><li><a href="/pgbackrest-docs/guide/deleting_stanza.html" class="sidebar-link">Deleting a Stanza</a></li><li><a href="/pgbackrest-docs/guide/dedicated_repository_host.html" class="sidebar-link">Dedicated Repository Host</a></li><li><a href="/pgbackrest-docs/guide/parallel_backup_restore.html" class="sidebar-link">Parallel Backup / Restore</a></li><li><a href="/pgbackrest-docs/guide/starting_and_stopping.html" class="sidebar-link">Starting And Stopping</a></li><li><a href="/pgbackrest-docs/guide/replication.html" class="sidebar-link">Replication</a></li><li><a href="/pgbackrest-docs/guide/asynchronous_archiving.html" class="sidebar-link">Asynchronous Archiving</a></li><li><a href="/pgbackrest-docs/guide/backup_from_standby.html" class="active sidebar-link">Backup From a Standby</a></li><li><a href="/pgbackrest-docs/guide/upgrading_postgresql.html" class="sidebar-link">Upgrading PostgreSQL</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="backup-from-a-standby"><a href="#backup-from-a-standby" aria-hidden="true" class="header-anchor">#</a> Backup From a Standby</h1><p>pgBackRest can perform backups on a standby instead of the primary. Standby backups require the pg-standby host to be configured and the backup-standby option enabled. If more than one standby is configured then the first running standby found will be used for the backup.</p><div class="language-ini extra-class"><pre class="language-ini"><code># repository:/etc/pgbackrest/pgbackrest.conf ⇒ Configure pg2-host/pg2-host-user and pg2-path
<span class="token selector">[demo]</span>
<span class="token constant">pg1-host</span><span class="token attr-value"><span class="token punctuation">=</span>pg-primary</span>
<span class="token constant">pg1-host-user</span><span class="token attr-value"><span class="token punctuation">=</span>postgres</span>
<span class="token constant">pg1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.4/demo</span>
<span class="token constant">pg2-host</span><span class="token attr-value"><span class="token punctuation">=</span>pg-standby</span>
<span class="token constant">pg2-host-user</span><span class="token attr-value"><span class="token punctuation">=</span>postgres</span>
<span class="token constant">pg2-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/postgresql/9.4/demo</span>

<span class="token selector">[global]</span>
<span class="token constant">backup-standby</span><span class="token attr-value"><span class="token punctuation">=</span>y</span>
<span class="token constant">process-max</span><span class="token attr-value"><span class="token punctuation">=</span>3</span>
<span class="token constant">repo1-path</span><span class="token attr-value"><span class="token punctuation">=</span>/var/lib/pgbackrest</span>
<span class="token constant">repo1-retention-full</span><span class="token attr-value"><span class="token punctuation">=</span>2</span>
<span class="token constant">start-fast</span><span class="token attr-value"><span class="token punctuation">=</span>y</span>
</code></pre></div><p>Both the primary and standby databases are required to perform the backup, though the vast majority of the files will be copied from the standby to reduce load on the primary. The database hosts can be configured in any order. pgBackRest will automatically determine which is the primary and which is the standby.</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># repository ⇒ Backup the demo cluster from pg2</span>
<span class="token function">sudo</span> -u pgbackrest pgbackrest --stanza<span class="token operator">=</span>demo --log-level-console<span class="token operator">=</span>detail backup
       <span class="token punctuation">[</span>filtered 2 lines of output<span class="token punctuation">]</span>
P00   INFO: execute exclusive pg_start_backup<span class="token punctuation">(</span><span class="token punctuation">)</span> with label <span class="token string">&quot;pgBackRest backup started at 2018-05-06 15:21:29&quot;</span><span class="token keyword">:</span> backup begins after the requested immediate checkpoint completes
P00   INFO: backup start archive <span class="token operator">=</span> 00000008000000000000002C, lsn <span class="token operator">=</span> 0/2C000028
P00   INFO: <span class="token function">wait</span> <span class="token keyword">for</span> replay on the standby to reach 0/2C000028
P00   INFO: replay on the standby reached 0/2C000348
P04   INFO: backup <span class="token function">file</span> pg-standby:/var/lib/postgresql/9.4/demo/base/12139/12009 <span class="token punctuation">(</span>240KB, 12%<span class="token punctuation">)</span> checksum 405f32d2767ec0f4e3357dfa948c9ed2c0c2874b
P04   INFO: backup <span class="token function">file</span> pg-standby:/var/lib/postgresql/9.4/demo/base/12139/12010 <span class="token punctuation">(</span>232KB, 24%<span class="token punctuation">)</span> checksum 80452b9a6bdeefb037869efd15bfa5e03b97e965
       <span class="token punctuation">[</span>filtered 11 lines of output<span class="token punctuation">]</span>
P04   INFO: backup <span class="token function">file</span> pg-standby:/var/lib/postgresql/9.4/demo/base/12139/11900_fsm <span class="token punctuation">(</span>24KB, 75%<span class="token punctuation">)</span> checksum 190512e3d1ba5a439c22abe7fbc6c74d267bf4b2
P02   INFO: backup <span class="token function">file</span> pg-standby:/var/lib/postgresql/9.4/demo/global/11884 <span class="token punctuation">(</span>16KB, 76%<span class="token punctuation">)</span> checksum 7b60e09a77005bdaf60a4199e44d526db194a97f
P01   INFO: backup <span class="token function">file</span> pg-primary:/var/lib/postgresql/9.4/demo/global/pg_control <span class="token punctuation">(</span>8KB, 76%<span class="token punctuation">)</span> checksum eeb0ac404201f00751e20f242444240a6c3de180
P02   INFO: backup <span class="token function">file</span> pg-standby:/var/lib/postgresql/9.4/demo/base/12139/11928 <span class="token punctuation">(</span>16KB, 77%<span class="token punctuation">)</span> checksum 984ba9ffb2732f63c72d00f631ccf68839c91621
P01   INFO: backup <span class="token function">file</span> pg-primary:/var/lib/postgresql/9.4/demo/backup_label <span class="token punctuation">(</span>238B, 77%<span class="token punctuation">)</span> checksum b39fd9e1cf56fb9bfbb28905e60fdc254b9a0ddf
P02   INFO: backup <span class="token function">file</span> pg-standby:/var/lib/postgresql/9.4/demo/base/12139/11927 <span class="token punctuation">(</span>16KB, 78%<span class="token punctuation">)</span> checksum b704cfc15485a76acdd8606421f6f66aa88948f1
P04   INFO: backup <span class="token function">file</span> pg-standby:/var/lib/postgresql/9.4/demo/global/11883 <span class="token punctuation">(</span>16KB, 78%<span class="token punctuation">)</span> checksum a08294d34a3bc32fd18f2eacd730504b06f29018
       <span class="token punctuation">[</span>filtered 19 lines of output<span class="token punctuation">]</span>
</code></pre></div><p>This incremental backup shows that most of the files are copied from the pg-standby host and only a few are copied from the pg-primary host.</p><p>pgBackRest creates a standby backup that is identical to a backup performed on the primary. It does this by starting/stopping the backup on the pg-primary host, copying only files that are replicated from the pg-standby host, then copying the remaining few files from the pg-primary host. This means that logs and statistics from the primary database will be included in the backup.</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/pgbackrest/pgbackrest/edit/master/guide/backup_from_standby.md" target="_blank" rel="noopener noreferrer">Edit this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/pgbackrest-docs/guide/asynchronous_archiving.html" class="prev">
          Asynchronous Archiving
        </a></span><span class="next"><a href="/pgbackrest-docs/guide/upgrading_postgresql.html">
          Upgrading PostgreSQL
        </a> →
      </span></p></div></div></div></div>
    <script src="/pgbackrest-docs/assets/js/34.9706bcdc.js" defer></script><script src="/pgbackrest-docs/assets/js/app.01ebea85.js" defer></script>
  </body>
</html>
