(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{159:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"parallel-backup-restore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parallel-backup-restore","aria-hidden":"true"}},[t._v("#")]),t._v(" Parallel Backup / Restore")]),a("p",[t._v("pgBackRest offers parallel processing to improve performance of compression and transfer. The number of processes to be used for this feature is set using the "),a("code",[t._v("--process-max")]),t._v(" option.")]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# repository ⇒ Check the number of CPUs")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("sudo")]),t._v(" lscpu\nArchitecture:          x86_64\nCPU op-mode"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":        32-bit, 64-bit\nByte Order:            Little Endian\nCPU"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":                8\nOn-line CPU"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" list:   0-7\nThread"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" per core:    1\n       "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("filtered 17 lines of output"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("It is usually best not to use more than 25% of the available CPUs for the backup command. Backups don't have to run that fast as long as they are performed regularly and the backup process should not impact database performance, if at all possible.")]),a("p",[t._v("The restore command can and should use all available CPUs because during a restore the PostgreSQL cluster is shut down and there is generally no other important work being done on the host. If the host contains multiple clusters then that should be considered when setting restore parallelism.")]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# repository ⇒ Perform a backup with single process")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("sudo")]),t._v(" -u pgbackrest pgbackrest --stanza"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("demo --type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("full backup\n")])])]),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[t._v("# repository:/etc/pgbackrest/pgbackrest.conf ⇒ Configure pgBackRest to use multiple backup processes\n"),a("span",{attrs:{class:"token selector"}},[t._v("[demo]")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("pg1-host")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("pg-primary")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("pg1-host-user")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("postgres")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("pg1-path")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/lib/postgresql/9.4/demo")]),t._v("\n\n"),a("span",{attrs:{class:"token selector"}},[t._v("[global]")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("process-max")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("3")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("repo1-path")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/lib/pgbackrest")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("repo1-retention-full")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("2")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("start-fast")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("y")]),t._v("\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# repository ⇒ Perform a backup with multiple processes")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("sudo")]),t._v(" -u pgbackrest pgbackrest --stanza"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("demo --type"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("full backup\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# repository ⇒ Get backup info for the demo cluster")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("sudo")]),t._v(" -u pgbackrest pgbackrest info\nstanza: demo\n    status: ok\n\n    db "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        wal archive min/max "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("9.4-1"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": 000000080000000000000022 / 000000080000000000000023\n\n        full backup: 20180506-152004F\n            timestamp start/stop: 2018-05-06 15:20:04 / 2018-05-06 15:20:13\n            wal start/stop: 000000080000000000000022 / 000000080000000000000022\n            database size: 25.5MB, backup size: 25.5MB\n            repository size: 3MB, repository backup size: 3MB\n\n        full backup: 20180506-152014F\n            timestamp start/stop: 2018-05-06 15:20:14 / 2018-05-06 15:20:19\n            wal start/stop: 000000080000000000000023 / 000000080000000000000023\n            database size: 25.5MB, backup size: 25.5MB\n            repository size: 3MB, repository backup size: 3MB\n")])])]),a("p",[t._v("The performance of the last backup should be improved by using multiple processes. For very small backups the difference may not be very apparent, but as the size of the database increases so will time savings.")])])}],!1,null,null,null);s.default=n.exports}}]);