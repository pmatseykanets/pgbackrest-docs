(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{166:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"backup-from-a-standby"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#backup-from-a-standby","aria-hidden":"true"}},[t._v("#")]),t._v(" Backup From a Standby")]),s("p",[t._v("pgBackRest can perform backups on a standby instead of the primary. Standby backups require the pg-standby host to be configured and the backup-standby option enabled. If more than one standby is configured then the first running standby found will be used for the backup.")]),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[t._v("# repository:/etc/pgbackrest/pgbackrest.conf ⇒ Configure pg2-host/pg2-host-user and pg2-path\n"),s("span",{attrs:{class:"token selector"}},[t._v("[demo]")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("pg1-host")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("pg-primary")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("pg1-host-user")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("postgres")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("pg1-path")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/lib/postgresql/9.4/demo")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("pg2-host")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("pg-standby")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("pg2-host-user")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("postgres")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("pg2-path")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/lib/postgresql/9.4/demo")]),t._v("\n\n"),s("span",{attrs:{class:"token selector"}},[t._v("[global]")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("backup-standby")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("y")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("process-max")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("3")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("repo1-path")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/lib/pgbackrest")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("repo1-retention-full")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("2")]),t._v("\n"),s("span",{attrs:{class:"token constant"}},[t._v("start-fast")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("y")]),t._v("\n")])])]),s("p",[t._v("Both the primary and standby databases are required to perform the backup, though the vast majority of the files will be copied from the standby to reduce load on the primary. The database hosts can be configured in any order. pgBackRest will automatically determine which is the primary and which is the standby.")]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("# repository ⇒ Backup the demo cluster from pg2")]),t._v("\n"),s("span",{attrs:{class:"token function"}},[t._v("sudo")]),t._v(" -u pgbackrest pgbackrest --stanza"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("demo --log-level-console"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("detail backup\n       "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("filtered 2 lines of output"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nP00   INFO: execute exclusive pg_start_backup"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" with label "),s("span",{attrs:{class:"token string"}},[t._v('"pgBackRest backup started at 2018-05-06 15:21:29"')]),s("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" backup begins after the requested immediate checkpoint completes\nP00   INFO: backup start archive "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 00000008000000000000002C, lsn "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0/2C000028\nP00   INFO: "),s("span",{attrs:{class:"token function"}},[t._v("wait")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("for")]),t._v(" replay on the standby to reach 0/2C000028\nP00   INFO: replay on the standby reached 0/2C000348\nP04   INFO: backup "),s("span",{attrs:{class:"token function"}},[t._v("file")]),t._v(" pg-standby:/var/lib/postgresql/9.4/demo/base/12139/12009 "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("240KB, 12%"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" checksum 405f32d2767ec0f4e3357dfa948c9ed2c0c2874b\nP04   INFO: backup "),s("span",{attrs:{class:"token function"}},[t._v("file")]),t._v(" pg-standby:/var/lib/postgresql/9.4/demo/base/12139/12010 "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("232KB, 24%"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" checksum 80452b9a6bdeefb037869efd15bfa5e03b97e965\n       "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("filtered 11 lines of output"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nP04   INFO: backup "),s("span",{attrs:{class:"token function"}},[t._v("file")]),t._v(" pg-standby:/var/lib/postgresql/9.4/demo/base/12139/11900_fsm "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("24KB, 75%"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" checksum 190512e3d1ba5a439c22abe7fbc6c74d267bf4b2\nP02   INFO: backup "),s("span",{attrs:{class:"token function"}},[t._v("file")]),t._v(" pg-standby:/var/lib/postgresql/9.4/demo/global/11884 "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("16KB, 76%"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" checksum 7b60e09a77005bdaf60a4199e44d526db194a97f\nP01   INFO: backup "),s("span",{attrs:{class:"token function"}},[t._v("file")]),t._v(" pg-primary:/var/lib/postgresql/9.4/demo/global/pg_control "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("8KB, 76%"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" checksum eeb0ac404201f00751e20f242444240a6c3de180\nP02   INFO: backup "),s("span",{attrs:{class:"token function"}},[t._v("file")]),t._v(" pg-standby:/var/lib/postgresql/9.4/demo/base/12139/11928 "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("16KB, 77%"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" checksum 984ba9ffb2732f63c72d00f631ccf68839c91621\nP01   INFO: backup "),s("span",{attrs:{class:"token function"}},[t._v("file")]),t._v(" pg-primary:/var/lib/postgresql/9.4/demo/backup_label "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("238B, 77%"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" checksum b39fd9e1cf56fb9bfbb28905e60fdc254b9a0ddf\nP02   INFO: backup "),s("span",{attrs:{class:"token function"}},[t._v("file")]),t._v(" pg-standby:/var/lib/postgresql/9.4/demo/base/12139/11927 "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("16KB, 78%"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" checksum b704cfc15485a76acdd8606421f6f66aa88948f1\nP04   INFO: backup "),s("span",{attrs:{class:"token function"}},[t._v("file")]),t._v(" pg-standby:/var/lib/postgresql/9.4/demo/global/11883 "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("16KB, 78%"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" checksum a08294d34a3bc32fd18f2eacd730504b06f29018\n       "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("filtered 19 lines of output"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("This incremental backup shows that most of the files are copied from the pg-standby host and only a few are copied from the pg-primary host.")]),s("p",[t._v("pgBackRest creates a standby backup that is identical to a backup performed on the primary. It does this by starting/stopping the backup on the pg-primary host, copying only files that are replicated from the pg-standby host, then copying the remaining few files from the pg-primary host. This means that logs and statistics from the primary database will be included in the backup.")])])}],!1,null,null,null);a.default=e.exports}}]);